

-- Create sequences section -------------------------------------------------

CREATE SEQUENCE "Sequencia1"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "SequenceReserva"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "IDCLIENTE"
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "SEQUENSEBOLETOSID"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "SEQUENSEAEROLINEA"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

-- Create tables section -------------------------------------------------

-- Table HOTEL

CREATE TABLE "HOTEL"(
  "ID" Number NOT NULL,
  "CODIGO" Varchar2(50 ) NOT NULL,
  "NOMBRE" Varchar2(30 ) NOT NULL,
  "DIRECCION" Varchar2(250 )
)
/

-- Add keys for table HOTEL

ALTER TABLE "HOTEL" ADD CONSTRAINT "PK_HOTEL" PRIMARY KEY ("ID")
/

ALTER TABLE "HOTEL" ADD CONSTRAINT "CODIGO" UNIQUE ("CODIGO")
/

-- Table RESERVA2

CREATE TABLE "RESERVA2"(
  "IDRESERVA" Number(10,0) NOT NULL,
  "FECHAIN" Date,
  "FECHAOUT" Date,
  "CANTIDAD_PERSONAS" Number DEFAULT 0
)
/

-- Add keys for table RESERVA2

ALTER TABLE "RESERVA2" ADD CONSTRAINT "PK_RESERVA2" PRIMARY KEY ("IDRESERVA")
/

ALTER TABLE "RESERVA2" ADD CONSTRAINT "IDRESERVA" UNIQUE ("IDRESERVA")
/

-- Table CLIENTE

CREATE TABLE "CLIENTE"(
  "IDCLIENTE" Number NOT NULL,
  "NOMBRE" Varchar2(80 ) NOT NULL,
  "TELEFONO" Varchar2(50 )
)
/

-- Add keys for table CLIENTE

ALTER TABLE "CLIENTE" ADD CONSTRAINT "PK_CLIENTE" PRIMARY KEY ("IDCLIENTE")
/

ALTER TABLE "CLIENTE" ADD CONSTRAINT "IDCLIENTE" UNIQUE ("IDCLIENTE")
/

-- Table BOLETO

CREATE TABLE "BOLETO"(
  "IDBOLETO" Number NOT NULL,
  "CODIGO" Varchar2(50 ),
  "NO_VUELO" Varchar2(50 ) NOT NULL,
  "FECHA" Date NOT NULL,
  "DESTINO" Varchar2(150 ) NOT NULL
        CONSTRAINT "CheckConstraintA1" CHECK (DESTINO in ('GUATEMALA','MEXICO','PANAMA')),
  "IDCLIENTE" Number NOT NULL,
  "CODIGO" Varchar2(150 ) NOT NULL
)
/

-- Add keys for table BOLETO

ALTER TABLE "BOLETO" ADD CONSTRAINT "PK_BOLETO" PRIMARY KEY ("IDBOLETO","IDCLIENTE","CODIGO")
/

ALTER TABLE "BOLETO" ADD CONSTRAINT "IDBOLETO" UNIQUE ("IDBOLETO")
/

-- Table AEROLINEA

CREATE TABLE "AEROLINEA"(
  "DESCUENTO" Number NOT NULL
        CONSTRAINT "CheckConstraintA3" CHECK (DESCUENTO >=10),
  "CODIGO" Varchar2(150 ) NOT NULL
)
/

-- Add keys for table AEROLINEA

ALTER TABLE "AEROLINEA" ADD CONSTRAINT "PK_AEROLINEA" PRIMARY KEY ("CODIGO")
/

ALTER TABLE "AEROLINEA" ADD CONSTRAINT "CODIGO" UNIQUE ("CODIGO")
/

-- Table RESERVA

CREATE TABLE "RESERVA"(
  "ID" Number NOT NULL,
  "IDCLIENTE" Number NOT NULL,
  "FECHAIN" Date,
  "FECHAOUT" Date,
  "CANTIDAD_PERSONAS" Number DEFAULT 0 NOT NULL
)
/

-- Add keys for table RESERVA

ALTER TABLE "RESERVA" ADD CONSTRAINT "PK_RESERVA" PRIMARY KEY ("ID","IDCLIENTE")
/

-- Trigger for sequence Sequencia1 for column ID in table HOTEL ---------
CREATE OR REPLACE TRIGGER "ts_HOTEL_Sequencia1" BEFORE INSERT
ON "HOTEL" FOR EACH ROW
BEGIN
  :new."ID" := "Sequencia1".nextval;
END;
/
CREATE OR REPLACE TRIGGER "tsu_HOTEL_Sequencia1" AFTER UPDATE OF "ID"
ON "HOTEL" FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID" in table "HOTEL" as it uses sequence.');
END;
/

-- Trigger for sequence SequenceReserva for column IDRESERVA in table RESERVA2 ---------
CREATE OR REPLACE TRIGGER "ts_RESERVA2_SequenceReserva" BEFORE INSERT
ON "RESERVA2" FOR EACH ROW
BEGIN
  :new."IDRESERVA" := "SequenceReserva".nextval;
END;
/
CREATE OR REPLACE TRIGGER "tsu_RESERVA2_SequenceReserva" AFTER UPDATE OF "IDRESERVA"
ON "RESERVA2" FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column "IDRESERVA" in table "RESERVA2" as it uses sequence.');
END;
/

-- Trigger for sequence SEQUENSEBOLETOSID for column IDBOLETO in table BOLETO ---------
CREATE OR REPLACE TRIGGER "ts_BOLETO_SEQUENSEBOLETOSID" BEFORE INSERT
ON "BOLETO" FOR EACH ROW
BEGIN
  :new."IDBOLETO" := "SEQUENSEBOLETOSID".nextval;
END;
/
CREATE OR REPLACE TRIGGER "tsu_BOLETO_SEQUENSEBOLETOSID" AFTER UPDATE OF "IDBOLETO"
ON "BOLETO" FOR EACH ROW
BEGIN
  RAISE_APPLICATION_ERROR(-20010,'Cannot update column "IDBOLETO" in table "BOLETO" as it uses sequence.');
END;
/


-- Create foreign keys (relationships) section ------------------------------------------------- 

ALTER TABLE "RESERVA" ADD CONSTRAINT "Relationship3" FOREIGN KEY ("ID") REFERENCES "HOTEL" ("ID")
/



ALTER TABLE "RESERVA" ADD CONSTRAINT "Relationship4" FOREIGN KEY ("IDCLIENTE") REFERENCES "CLIENTE" ("IDCLIENTE")
/



ALTER TABLE "BOLETO" ADD CONSTRAINT "Relationship5" FOREIGN KEY ("IDCLIENTE") REFERENCES "CLIENTE" ("IDCLIENTE")
/



ALTER TABLE "BOLETO" ADD CONSTRAINT "Relationship6" FOREIGN KEY ("CODIGO") REFERENCES "AEROLINEA" ("CODIGO")
/





